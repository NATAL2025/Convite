<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lanche de Natal</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
    font-family: 'Inter', Arial, sans-serif;
    background: url('nss.jpg') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; 
    min-height: 100vh;
    color: #333;
}

#alertaCentral {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #f87171;
    color: white;
    padding: 20px 30px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    z-index: 9999;
}
#alertaCentral.hidden { display: none; }

#telaInicial {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    width: 100%;
}

#btnIniciar {
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 20px 40px; /* altura mantida, padding horizontal original */
    width: 400px;       /* comprimento maior */
    font-size: 20px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}
#btnIniciar:hover {
    background-color: #13803d;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

#conteudoPrincipal {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
}

.conteudoBox {
    background: rgba(255,255,255,0.95);
    padding: 20px 25px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    width: 350px;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
}
#caixaEscolha { padding: 20px 25px; }
.conteudoBox:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}
h2, h3, p { text-align: center; margin: 10px 0; }
#caixaEscolha label {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 20px;
    color: #1a1a1a;
    cursor: pointer;
}
input[type="text"], input[type="number"], select {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 15px;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
}
input[type="radio"] {
    margin-right: 10px;
    accent-color: #16a34a;
    cursor: pointer;
    width: 20px;
    height: 20px;
}
button.formButton {
    width: 100%;
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
button.formButton:hover {
    background-color: #13803d;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
#msgInscricao, #msgNegar {
    font-weight: 600;
    margin-top: 10px;
    color: #000000;
    text-align: center;
}
.hidden { display: none; }
</style>
</head>
<body>

<div id="alertaCentral" class="hidden"></div>

<div id="telaInicial">
    <button id="btnIniciar">Natal 2025</button>
</div>

<div id="conteudoPrincipal">
    <div id="caixaEscolha" class="conteudoBox">
        <h2>游꾻 Lanche de Natal</h2>
        <p>Escolhe uma op칞칚o:</p>
        <label><input type="radio" name="opcao" value="inscricao" onclick="mostrarOpcao()"> Vou ao Lanche</label>
        <label><input type="radio" name="opcao" value="negar" onclick="mostrarOpcao()"> N칚o vou ao Lanche</label>
    </div>

    <div id="formInscricao" class="conteudoBox hidden">
        <h3>Vou ao Lanche</h3>
        <label>NIF</label>
        <input type="text" id="nif">
        <button class="formButton" onclick="gerarInscricao()">Submeter</button>
        <p id="msgInscricao"></p>
    </div>

    <div id="formNegar" class="conteudoBox hidden">
        <h3>N칚o vou ao Lanche</h3>
        <label>NIF</label>
        <input type="text" id="nifNegar">
        <button class="formButton" onclick="gerarNegativa()">Submeter</button>
        <p id="msgNegar"></p>
    </div>
</div>

<script>
const SUPABASE_URL = 'https://bijndfsxrzjviwrdvwms.supabase.co';
const SUPABASE_API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpam5kZnN4cnpqdml3cmR2d21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NTA5NTIsImV4cCI6MjA2NjQyNjk1Mn0.EWaFInuqTaxvnjytb40DdnflEbBrbSYcViKLYc_kKBk';

const sites = {
    "Columbano": ["219250871","251820122","275457915","273129848","262548275","258626267","209733799","237747995","232692955","260551678","274310112","244031940","257709762","167132350","224135600","225604370","223409529","211987620","233891480","237567407","227615522","220807949","198751656","207069700","229187439","171576314","272465526","177458380","219289662","253253977","150034423","280216114","136197655","197758991","301840652","230933785","231250401","236917285","202452824","267169361","245683437","290284880","264122330","226395820","311022200","256253064","234281413","214523209","212844865","239843789","294365257","216240689","238225542","296919713","249693283","274420465","216215064","232311366","222850914","289684811","220315973","299930874","229182623","233349430","233780823","238275426","241737834","298650452","306667002","266668780","256239240","247619280","213806932","190768134","223183270","182588882","242057349","227282833","229942792","153990546","209980303","242141811","248172140","224756680","253629012","252061144","207215260","222868589","228612497","198821530","223549231","169813185","239544390","249043033","212183630","138271780","210213574","195539389","225783215","217423540","212535870","202100391","204401534","228857783","214993264","209801824","232954771","215448030","195261089","225962985","223053180","243161565","236503790","215247590","199966478","166304484","164382429","209501898","251155080","217184227","210619678","281286280","230722784","180601954","293336121","126068569","224728164","251245802","213107228","286753286","214943283","198397771","277263727","230167926","180394991","256639329","188416412","186607032","177504633","279416105","232202303","179899899","218493690","216858356","246905662","252664809","223332860","254763235","222901624","219065942","191309184","197426980","217760775","254305067","284823279","237709155","271626585","206551983","199723656","274263718","253440270","221174001","260209040","212144391","270452354","206207816","241714710","242030394","196079934","247249262","234104856","298812525","298848368","267450460","227168348","223185205","246266007","254950540","238281701","252768442","259235067","227735820","237307030","221982620","225285800","201759012","221643354","217480730","204026563","205522904","272892882","270379576","247287032","199425515","199209499","277834520","195339150","257398830","205345115","234216913","227663454","218814569","279531656","222532769","288496531","264387406","249512700","175117349","270866612","221842659","256079129","234201274","241083826","213858690","277719232","252945409","112387144","241270995","198808640","240730364","272229350","245214399","273978551","254902731","250942089","251161145","266329438","253139287","207113602","205885616","250805820","213968347","242503276","203060172","232496382","271727721","277487650","223889210","225564980","274060124","245447342","261219634","237687895","231788363","200917757","272656151","238587851","221304045","249097958","247999326","222109726","295145196","256523614","252614933","223158046","240024206","247594814","258354631","231152418","170640752","254891357","247045217","297707558","274979225","240342313","242913172","250007886","232099120","243800622","263815145","231323514","234549599","295959681","224065416","223576409","232331243","301872031","242515150","214405648","241288398","228522838","247204927","239530772","261142470","223266345","232892920","267215584","252545796","214226395","232742650","249959291","213112442","262951843","256063567","263652858","252829611","211232700","272355852","207059837","258256273","252530020","227389620","209644958","221524002","251559726","228012260","197796230","215815548","248742779","231710720","203922654","169334406","291303625","246290676","176994637","232846570","228275059","292872895","192614495","191127752","222800747","298584980","232839360","224526766","210344148","250699338","241704952","255117655","271987235","245204245","268144168","244335656","239447867","234327146","250677083","232335532","307502686","285062700","239646606","237568608","255201801","267926880","249642360","233865314","296986895","299710211","281893896","192188224","296267830","253711053","243983409","229968236","231453442","283154020","244268371","250372134","168246252","250615240","268642133","303788283","243697988","170353702","259949027","281415811","254392237","271670487","229515525","232489971","212793861","289927684","184879868","229760724","207162999","220522766","238277321","270009523","210307080","253761379","249019116","266648185","238387844","211946729","212834045","209345179","217774210","238977897","322039975","311265065","218142005","244673560","270622829","220499748","109616367","245013318","210202084","238418308","230229751","222580372","219518998","268430519","224855883","262202310","267870264","249641810","246004312","319055175","230907920","219125910","234408910","271035781","219571775","272295329","244766691","215676491","249977478","257495894","277824427","260095427","233525327","264511891","274389681","221660976","257255800","253313864","258917717","227166264","296661759","299423220","242854052","252104714","227971205","213090783","260155195","285899643","256275653","248867792","233582681","253279992","226757293","275024920","228304822","263074862","264643453","296641901","253764416","240901525","217061290","208416714","205889654","217318347","253724031","231312997","272703834","194852741","302690336","226395430","233143920","242764460","268357900","273964054","214518540","231093020","287897508","265196272","250469170","218777060","264392248","272880086","248313444","228967945","238085538","262576155","209968613","228038766","207852138","314953051","287910172","315028718","297549626","256100233","290797306","266893597","226964701","228793378","302495231","301173320","294380094","305210785","270113088","228272211","232312745","316606782","229243932","293317666","266286623","199624879","241528364","135656052","320991806","294004742","308001443","262043998","296671622","313809453","293781265","195282191","224147757","303423072","294232311","295973315","267200609","208394699","126327149","199624690","264643143","250919605","304590657","316097926","274364832","258872764","230307809","235614092","242215645","294134646","240729854","246538970","234957522","262713608","303245026","260296546","195220110","199429510","297251961","314922717","298774445","262904543","272620475","302040927","228982391","205259022","197308929","234536934","220944512","299673138","222208007","238225836","237655268","249145545","236249150","237664178","251266630","258370009","302798226","321138740","237084830","305340867","304327239","269271341","297663739","238318818","293938865","309314453","237707861","314922237","314844147","306285843","252589246","255942133","225798530","315281448","310661595","286139456","220310742","324603673","309323525","320721868","215769909","214148084","267669321","303223154","290797470","236266446","195460880","245148612","225188805","217037992","215765443","227221834","255774656","235768847","201513978","239301668","228559944","231063083","237330440","224718983","231433387","137823410","214841898","270345329","273898787","167132423","197586325","244766797","266879020","254576362","243499663","226577120","230682421","200760017","214134474","252028570","324111770","210906936","229669727","263489663","216128021","237717530","252134443"],
    "B치ltico": ["271250240","321851358","256215073","325822395","244026750","320998916","312449917","320628965","273992953","243134800","293838690","315053267","329096150","318586851","256014515","302365710","309957290","242556558","312315597","328970964","315444860","212615041","298674343","324409591","311394566","324320477","292484852","321765516","303065559","315131586","322739128","311746578","219904006","282422714","221352368","209395397","298832798","324752504","245201122","249161680","323860427","307432572","318596741","198881070","319156222","313945217","300388403","250157438","212685007","324600038","299992500","272560065","311616372","298801230","331623889","288570383","330381679","308937457","246788461","270641785","293696098","250176858","270455566","312011040","301051534","274732505","319828174","309670241","226740030","314774770","290331560","301451001","276395298","222094400","321491963","309963656","298705125","311668801","251568377","249967456","252784502","243643888","199341761","313062722","309472156","220480648","272897760","308782232","328529311","253310113","323725120","318366550","319493520","208933409","269802649","231687206","313976333","268086192","314637265","302544763","254363598","314473513","308419693","251100529","315472308","314731938","233433120","250666251","242395554","232574537","257294910","262852160","317198033","261007424","312766602","241140862","215095740","248259210","270190040","276568230","247915840","238572943","247524913","269988041","297613090","226282015","327278765","322043654","309519160","219734682","310442249","299120040","308210530","315798106","177102357","280399928","288379497","209502649","316061042","311356010","315941235","281211264","312074646","325689989","252971884","253344387","288621816","313659273","323788173","288698614","319398161","311666787","314007636","309326338","220242771","258031395","245168095","310598150","314212701","310559049","244105308","311178880","225614464","249596741","267651066","220270945","228137144","254393616","220445575","212853244","233992650","210144777","211005428","235796735","267141050","289637694","289916593","223496731","297020242","281355819","248360221","266623549","264134621","279783868","199202060","224521152","242164951","264333918","211280305","220906432","241121760","248440535","278876854","224059726","164385002","246443081","214517586","293043477","267426240","259966959","295155817","248391577","246237635","256773955","237734397","275962520","251258432","213595150","211819000","235607991","271727144","214571165","224971859","221194070","203974433","212549170","268441936","213196204","253039690","255419180","232296952","309173760","302500456","303132426","260729450","251308642","209899387","196666074","288385756","262340330","246791039","295424648","223243124","226546047","294244778","222252332","204710383","231795033","112438032","249437716","122022564","252479351","299496422","231442530","292301391","195085159","254771513","228469430","212106287","218724802","262538113","234774002","209353880","246854677","271376147","297019929","269574786","300187912","253967546","237116987","221985182","312103727","313200416","291771602","229997538","271890410","313521492","307932656","261412906","242760295","248709682","215796209","300496672","222065214","299247082","164397701","211890758","244431787","116547561","203810767","305185322","200950177","241570050","217515096","225251213","217513298","210360917","247012157","202673405","217546170","221334122","247809977","257303308","251571858","233534741","232270902","115062556","293347255","234519487","292666403","297051571","314583750","299630552","297040014","247405353","297196553","310376890","315469226","268041830","263231674","291724612","314583360","253328047","243201036","252877799","259328960","255969392","249428199","252178890","201833131","231262078","221201025","204935431","267363575","270273999","296969982","272741507","255934289","214492150","268782636","300090048","248821563","110283570","170051420","187291896","241923409","220230471","255871465","224577719","201775166","252572190","224904736","269627138","290210585","307360750","253017823","239967402","205817769","226168700","214076563","265682401","271967056","245079289","271776560","286487500","232545057","288934113","294240756","249227401","209687240","259176494","254297641","291081959","225049783","233934383","289492734","238407063","262515903","277800056","292841663","299861899","285654551","298024772","307579577","297600354","296180386","276573196","304690163","279879377","293483884","265766346","294531327","294802223","261069357","259631647","293490830","261164350","251649121","302500235","254379680","320850692","304899844","296649120","241160146","310068185","317695207","234752386","269217274","304780502","293103151","221332936","274307774","310501407","299530248","304825433","250714973","237120542","317325566","272566985","230567657","314522743","230683207","217819079","193580632","227258606","265271142","300496591","277930430","220280002","255924704","269881468","292135378","204267854","303050012","291161154","295130580","207018375","232020558","293509514","220856575","266630979","195996240","229306810","217898548","308341619","276625374","255581076","266813399","304869589","203738667","186865635","236993097","298073552","276056051","231250738","216259592","297056638","296555304","217920349","243479093","226440400","286788888","305387421","297002333","219073210","237131269","302367543","199166951","244612188","295499982","313818428","263025969","264681746","223233021","300479956","310514371","311149103","290699622","304998664","309289963","294803890","293554218","227306007","244402558","218153163","319337618","239363701","264232461","300738404","302224467","290164966","297978012","245798897","244037779","302683747","310133017","307978214","295489448","293633100","294385010","309192684","311111238","254035620","297888790","308915836","223695025","301141738","248936867","202118843","296759228","314427228","252050576","251849309","318496747","317371894","302759891","314580441","312129882","236218883","259759384","316691887","293951098","295727276","224836250","312586841","292912790","271573023","309498023","308843657","244989494","317390082","307758206","309499216","313823189","222610727","249773406","308446852","274262231","215384270","248495518","221024654","274068397","319900908","326515143","300734123","307608174","311643930","312807732","312595220","310692776","290750075","233752161","320384381","300479123","315725974","321884744","249210711","316380741","206209495","226939090","206191634","232775958","296861448","292035802","312074506","267815760","307758419","309483255","299595463","312188838","313995079","311749232","309073812","296649007","309952824","297698257","297496816","285341456","319880230","307164667","303215712","305464639","297161555","312641648","303243724","290694531","310501377","204207924","309941849","236673939","297792865","234970839","255831757","206030606","315333316","298689669","319379906","316528587","314464603","317291629","303391731","250492709","274506777","309745560","309779944","263987213","253372291","297567705","273363662","313102805","308009240","311226540","306785579","233260528","318941465","255299010","262168537","219754004","317781286","281064997","249714809","259841528","236633279","246829710","259409014","241461448","225203138","314344721","309969484","259783340","246453303","249822946","224150545","273380052","297399870","294415530","261340620","310008794","232939101","248941623","230343724","311305172","263087212","219996920","288044673","306154790","311696546","326667407","308963725","315474335","27742859","295741953","254763960","321765346","269287620","252777476","263449661","266809286","244898774","297587471","268845742","321999487","176811362","205424961","302839151","324381085","301508135","328191175","326209204","301153132","209698241","319644863","230250084","240490215","216748097","308222024","329096974","270582304","242142362","309741980","277651786","316555908","215915372"],
    "Alexandre Herculano": ["316973661","310072298","270028781","291627846","248869337","166271640","233578846","257284257","259889377","275356400","273472860","247314021","271721669","267134746","268691002","321813839","248828967","290112320","267964250","320739961","294472380","287284395","330960067","291466397","330566660","328501050","269284346","297864149","267462247","290076439","269103872","316387878","255838557","213914697","205331602","236694170","210170948","244474141","233380892","235109193","254671683","226748499","189849665","228631661","201660997","221652507","272165034","203186869","226581128","215094077","226216993","200821598","215861078","243315996","260372471","222534532","249435802","245800212","249479109","222452650","215094085","261111000","260158240","260446769","270325816","216922860","233327290","267602456","244954720","219304769","278509746","263795870","250048442","217019412","250350840","217068472","198517963","202497860","263625400","226146847","226767604","270129898","301266166","236167073","206130619","222696184","234565489","199585717","270199535","279063180","275475069","248047604","257174133","285726153","189725257","211758841","257732594","278509916","262720450","235364681","256880247","275973638","256264694","249855011","253086868","239416074","308329511","329945351","275811301","264847164","309964091","293232741","293453837","228568714","261975730","261023616","298759977","313218129","215106504","243503415","208662600","249420597","297359339","245036130","230761364","233498079","260372021","112758118","178602833","210406569","229967957","187199035","245797734","207764620","247878022","242939074","232520852","247673358","249798433","230125883","271771283","248670336","250490218","227332202","230752551","271733756","230817998","163986975","246647248","241471915","234659793","225703025","269766367","268241180","263508951","239285840","253413532"],
    "칄vora": ["250976668","233645152","268808279","259081957","253220351","269098542","261760254","222444690","250683784","206528418","233380566","249881357","252296982","212071076","248208284","228895677","242049478","219704120","243694008","207422036","205143989","221293825","212661736","233980954","222591145","229132219","274934663","227399161","250072238","248007319","244037116","243206518","211536415","245633170","268418195","221036822","250028255","222172460","236724665","199701334","233048715","214388913","243851740","232401128","199093970","230004059","226064565","266833764","236676350","199311846","221561544","245142061","252832272","232377120","235856002","263600092","246440244","236709518","238498735","228212154","240984366","247076171","243077106","240149335","227027493","227281926","213717646","229081061","254395708","239251920","213725533","190787546","191089192","211750336","251538583","221797750","247458538","262857120","243994117","253530040","212366076","230247849","256351660","233879056","264204875","224243713","218840306","234530251","201728036","239245180","225371626","206265603","206195060","224227718","233924540","233814221","227610849","223499064","264754824","232846308","209827068","213423715","225580632","229680267","205534058","215734076","190964103","209495391","219026157","230128696","212219170","238292908","208534997","215032381","221835040","221054936","220882070","207709688","245038485","211276057","218198140","247191957","230909833","217369642","220756767","222267593","215155483","207760861","200823868","234803282","201906139","224059084","192042688","213709473","247401250","208968822","227487311","228327750","220667446","234159855","215539290","230910912","233974822","231030142","230895395","205715532","232746656","212549995","233093044","241211646","263512061","252559258","266064167","120488299","258703032","261379917","255941633","241503671","210093366","266904173","210127309","206646976","231468997","264012895","234163356","188271660","237196859","193317303","225472570","258795263","250311615","256302545","229398030","228777186","226154254","243795815","233491260","255092598","235197459","237983087","233108882","241044367","216523559","242916678","238586260","237461200","260020230","271344385","119001551","253189217","225148846","221912304","250116316","254469540","245423117","246276088","203006437","244234205","248298500","249006847","252003616","253274389","168169860","207966834","252821505","251560341","241366496","230034705","231589158","255574592","184574897","210574151","224871641","239709705","209046686","215961080","239732324","223645206","250888548","222071397","235073008","233259511","223277355","220854734","252511999","265464129","256972184","231421230","212507672","266027423","249982145","255893507","249646277","266384528","220231931","236736558","263986446","250130734","246548142","219169306","257555560","228844347","201286955","243105266","249383403","257965912","240280423","274870290","260470228","261364340","250585316","232608881","230877567","258724374","223269816","211685585","179767933","205784143","240814770","219556768","239288505","237144492","265139953","224098691","241118689","266604170","217130569","203191293","278743749","248548212","244931100","262392089","266636101","251429300","259406287","201286610","221745645","242586309","213456338","214056996","262329026","251151522","229817009","250112280","267647450","213410435","258235853","241153140","229374166","275360369","266224679","217924239","241372178","256451729","264367170","230147992","256777250","228629152","255038356","247741132","231673760","253036739","254870376","250626292","225490650","251061523","201394200","237664437","239812727","223659649","248645269" ],
    "Alfragide": ["200291009","201544903","221733582","178823619","256068151","185925995","215725450","202343707","239786610","247266337","218576145","260062030","243401035","216892155","239761588","260047600","252877624","204746655","292178980","301791007","306408651","247183768","209890266","215110048","220193029","282398260","209194740","186867760","312398018","235613363","301751919","301358494","246341068","229917275","265726042","259067261","254953301","251246396","309635160","249967413","230207200","198808631","310633591","303824921","244720398","311809995","251002799","257338748","297005820","268697230","310682207","260771600","324027273","286752719","268532699","332459098","271537302","308063546","219958130","251660907","248762648","302789847","268491739","320276562","184966094","325480222","310124190","260710792","295743468","275333191","301361070","298059479","273000900","259210439","252324870","263069400","222850655","311829554","212863665","225593432","323738559","297674714","247183873","325583242","267799446"]
};
    
// Verifica se NIF j치 respondeu
async function nifJaRegistado(nif) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/participantes?nif=eq.${nif}`, {
        method: "GET",
        headers: {
            'apikey': SUPABASE_API_KEY,
            'Authorization': `Bearer ${SUPABASE_API_KEY}`
        }
    });
    const data = await res.json();
    return data.length > 0;
}

function getSiteDoNif(nif) {
    for (const [site, nifs] of Object.entries(sites)) {
        if (nifs.includes(nif)) return site;
    }
    return null;
}

// Gera c칩digo 칰nico
async function gerarCodigoUnico() {
    const res = await fetch(
        `${SUPABASE_URL}/rest/v1/participantes?select=codigo_negativa&order=codigo_negativa.desc&limit=1`,
        { method: "GET", headers: { 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}` } }
    );
    const data = await res.json();
    return (data.length === 0 || !data[0].codigo_negativa) ? 1 : Number(data[0].codigo_negativa) + 1;
}

// Navega칞칚o
document.getElementById("btnIniciar").addEventListener("click", () => {
    document.getElementById("telaInicial").style.display = "none";
    document.getElementById("conteudoPrincipal").style.display = "flex";
});

function mostrarOpcao() {
    const opcao = document.querySelector('input[name="opcao"]:checked').value;
    document.getElementById("formInscricao").classList.add("hidden");
    document.getElementById("formNegar").classList.add("hidden");
    if (opcao === "inscricao") document.getElementById("formInscricao").classList.remove("hidden");
    else document.getElementById("formNegar").classList.remove("hidden");
}

function mostrarAlerta(mensagem) {
    const alerta = document.getElementById("alertaCentral");
    alerta.innerText = mensagem;
    alerta.classList.remove("hidden");
    setTimeout(() => alerta.classList.add("hidden"), 3000);
}

// Submeter inscri칞칚o
async function gerarInscricao() {
    const nif = document.getElementById("nif").value.trim();
    if (!nif) return mostrarAlerta("Preencha o NIF.");
    if (await nifJaRegistado(nif)) return mostrarAlerta("Este NIF j치 submeteu uma resposta. Para altera칞칫es, contacta-nos.");
    const site = getSiteDoNif(nif);
    if (!site) return mostrarAlerta("Este NIF n칚o est치 autorizado.");
    const codigo = await gerarCodigoUnico();
    const mensagem = `Registo efetuado com sucesso\nNIF: ${nif}\nSite: ${site}\nN칰mero: ${codigo}\n\n\nGuarda este n칰mero m치gico!`;
    document.getElementById("msgInscricao").innerText = mensagem;

    await fetch(`${SUPABASE_URL}/rest/v1/participantes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}`, 'Prefer': 'return=representation' },
        body: JSON.stringify([{ nome: "N칚o informado", coordenacao: "N칚o informada", nif, site, codigo_negativa: codigo, status: "Inscrito" }])
    });

    gerarImagem(mensagem, "Confirmacao_Inscricao.png");
}

// Submeter recusa
async function gerarNegativa() {
    const nif = document.getElementById("nifNegar").value.trim();
    if (!nif) return mostrarAlerta("Preencha o NIF.");
    if (await nifJaRegistado(nif)) return mostrarAlerta("Este NIF j치 submeteu uma resposta. Para altera칞칫es, contacta-nos.");
    const site = getSiteDoNif(nif);
    if (!site) return mostrarAlerta("Este NIF n칚o est치 autorizado.");
    const codigo = await gerarCodigoUnico();
    const mensagem = `Recusa registada com sucesso\nNIF: ${nif}\nN칰mero: ${codigo}\n\n\nGuarda este n칰mero m치gico!`;
    document.getElementById("msgNegar").innerText = mensagem;

    await fetch(`${SUPABASE_URL}/rest/v1/participantes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}`, 'Prefer': 'return=representation' },
        body: JSON.stringify([{ nome: "N칚o informado", coordenacao: "N칚o informada", nif, site, codigo_negativa: codigo, status: "Recusa" }])
    });

    gerarImagem(mensagem, "Recusa_Convite.png");
}

// Gerar imagem
function carregarImagem(src) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
    });
}

async function gerarImagem(texto, nomeArquivo) {
    const canvas = document.createElement("canvas");
    canvas.width = 700;
    canvas.height = 400;
    const ctx = canvas.getContext("2d");

    try {
        const bg = await carregarImagem('TESTE.png');
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#000000";
        ctx.textAlign = "center";

        const linhas = texto.split("\n");
        const lineHeight = 30;
        const totalHeight = (linhas.length - 1) * lineHeight + 36;
        let startY = (canvas.height - totalHeight) / 2 + 10;

        ctx.font = "22px Arial";
        linhas.slice(0, -1).forEach((linha, i) => {
            ctx.fillText(linha, canvas.width / 2, startY + i * lineHeight);
        });

        ctx.font = "36px Arial";
        ctx.fillText(linhas[linhas.length - 1], canvas.width / 2, startY + (linhas.length - 1) * lineHeight);

        const link = document.createElement("a");
        link.download = nomeArquivo;
        link.href = canvas.toDataURL("image/png");
        link.click();
    } catch (err) {
        mostrarAlerta("Erro ao carregar a imagem.");
        console.error(err);
    }
}
</script>
</body>
</html>











