<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lanche de Natal</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body {
    font-family: 'Inter', Arial, sans-serif;
    background: url('nss.jpg') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; 
    min-height: 100vh;
    color: #333;
}

#alertaCentral {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #f87171;
    color: white;
    padding: 20px 30px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    z-index: 9999;
}
#alertaCentral.hidden { display: none; }

#telaInicial {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    width: 100%;
}

#btnIniciar {
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 20px 40px; /* altura mantida, padding horizontal original */
    width: 400px;       /* comprimento maior */
    font-size: 20px;
    font-weight: 600;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}
#btnIniciar:hover {
    background-color: #13803d;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

#conteudoPrincipal {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
}

.conteudoBox {
    background: rgba(255,255,255,0.95);
    padding: 20px 25px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    width: 350px;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
}
#caixaEscolha { padding: 20px 25px; }
.conteudoBox:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}
h2, h3, p { text-align: center; margin: 10px 0; }
#caixaEscolha label {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 20px;
    color: #1a1a1a;
    cursor: pointer;
}
input[type="text"], input[type="number"], select {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 15px;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
}
input[type="radio"] {
    margin-right: 10px;
    accent-color: #16a34a;
    cursor: pointer;
    width: 20px;
    height: 20px;
}
button.formButton {
    width: 100%;
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
button.formButton:hover {
    background-color: #13803d;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
#msgInscricao, #msgNegar {
    font-weight: 600;
    margin-top: 10px;
    color: #000000;
    text-align: center;
}
.hidden { display: none; }
</style>
</head>
<body>

<div id="alertaCentral" class="hidden"></div>

<div id="telaInicial">
    <button id="btnIniciar">Natal 2025</button>
</div>

<div id="conteudoPrincipal">
    <div id="caixaEscolha" class="conteudoBox">
        <h2>游꾻 Lanche de Natal</h2>
        <p>Escolha uma op칞칚o:</p>
        <label><input type="radio" name="opcao" value="inscricao" onclick="mostrarOpcao()"> Vou ao Lanche</label>
        <label><input type="radio" name="opcao" value="negar" onclick="mostrarOpcao()"> N칚o vou ao Lanche</label>
    </div>

    <div id="formInscricao" class="conteudoBox hidden">
        <h3>Vou ao Lanche</h3>
        <label>NIF</label>
        <input type="text" id="nif">
        <button class="formButton" onclick="gerarInscricao()">Submeter</button>
        <p id="msgInscricao"></p>
    </div>

    <div id="formNegar" class="conteudoBox hidden">
        <h3>N칚o vou ao Lanche</h3>
        <label>NIF</label>
        <input type="text" id="nifNegar">
        <button class="formButton" onclick="gerarNegativa()">Submeter</button>
        <p id="msgNegar"></p>
    </div>
</div>

<script>
const SUPABASE_URL = 'https://bijndfsxrzjviwrdvwms.supabase.co';
const SUPABASE_API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpam5kZnN4cnpqdml3cmR2d21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NTA5NTIsImV4cCI6MjA2NjQyNjk1Mn0.EWaFInuqTaxvnjytb40DdnflEbBrbSYcViKLYc_kKBk';

const sites = {
    "Columbano": ["266329438", "266329439"],
    "B치ltico": ["12345", "12346"],
    "Alexandre Herculano": ["316973661","310072298","270028781","291627846","248869337","166271640","233578846","257284257","259889377","275356400","273472860","247314021","271721669","267134746","268691002","321813839","248828967","290112320","267964250","320739961","294472380","287284395","330960067","291466397","330566660","328501050","269284346","297864149","267462247","290076439","269103872","316387878","255838557","213914697","205331602","236694170","210170948","244474141","233380892","235109193","254671683","226748499","189849665","228631661","201660997","221652507","272165034","203186869","226581128","215094077","226216993","200821598","215861078","243315996","260372471","222534532","249435802","245800212","249479109","222452650","215094085","261111000","260158240","260446769","270325816","216922860","233327290","267602456","244954720","219304769","278509746","263795870","250048442","217019412","250350840","217068472","198517963","202497860","263625400","226146847","226767604","270129898","301266166","236167073","206130619","222696184","234565489","199585717","270199535","279063180","275475069","248047604","257174133","285726153","189725257","211758841","257732594","278509916","262720450","235364681","256880247","275973638","256264694","249855011","253086868","239416074","308329511","329945351","275811301","264847164","309964091","293232741","293453837","228568714","261975730","261023616","298759977","313218129","215106504","243503415","208662600","249420597","297359339","245036130","230761364","233498079","260372021","112758118","178602833","210406569","229967957","187199035","245797734","207764620","247878022","242939074","232520852","247673358","249798433","230125883","271771283","248670336","250490218","227332202","230752551","271733756","230817998","163986975","246647248","241471915","234659793","225703025","269766367","268241180","263508951","239285840","253413532"],
    "칄vora": ["250976668","233645152","268808279","259081957","253220351","269098542","261760254","222444690","250683784","206528418","233380566","249881357","252296982","212071076","248208284","228895677","242049478","219704120","243694008","207422036","205143989","221293825","212661736","233980954","222591145","229132219","274934663","227399161","250072238","248007319","244037116","243206518","211536415","245633170","268418195","221036822","250028255","222172460","236724665","199701334","233048715","214388913","243851740","232401128","199093970","230004059","226064565","266833764","236676350","199311846","221561544","245142061","252832272","232377120","235856002","263600092","246440244","236709518","238498735","228212154","240984366","247076171","243077106","240149335","227027493","227281926","213717646","229081061","254395708","239251920","213725533","190787546","191089192","211750336","251538583","221797750","247458538","262857120","243994117","253530040","212366076","230247849","256351660","233879056","264204875","224243713","218840306","234530251","201728036","239245180","225371626","206265603","206195060","224227718","233924540","233814221","227610849","223499064","264754824","232846308","209827068","213423715","225580632","229680267","205534058","215734076","190964103","209495391","219026157","230128696","212219170","238292908","208534997","215032381","221835040","221054936","220882070","207709688","245038485","211276057","218198140","247191957","230909833","217369642","220756767","222267593","215155483","207760861","200823868","234803282","201906139","224059084","192042688","213709473","247401250","208968822","227487311","228327750","220667446","234159855","215539290","230910912","233974822","231030142","230895395","205715532","232746656","212549995","233093044","241211646","263512061","252559258","266064167","120488299","258703032","261379917","255941633","241503671","210093366","266904173","210127309","206646976","231468997","264012895","234163356","188271660","237196859","193317303","225472570","258795263","250311615","256302545","229398030","228777186","226154254","243795815","233491260","255092598","235197459","237983087","233108882","241044367","216523559","242916678","238586260","237461200","260020230","271344385","119001551","253189217","225148846","221912304","250116316","254469540","245423117","246276088","203006437","244234205","248298500","249006847","252003616","253274389","168169860","207966834","252821505","251560341","241366496","230034705","231589158","255574592","184574897","210574151","224871641","239709705","209046686","215961080","239732324","223645206","250888548","222071397","235073008","233259511","223277355","220854734","252511999","265464129","256972184","231421230","212507672","266027423","249982145","255893507","249646277","266384528","220231931","236736558","263986446","250130734","246548142","219169306","257555560","228844347","201286955","243105266","249383403","257965912","240280423","274870290","260470228","261364340","250585316","232608881","230877567","258724374","223269816","211685585","179767933","205784143","240814770","219556768","239288505","237144492","265139953","224098691","241118689","266604170","217130569","203191293","278743749","248548212","244931100","262392089","266636101","251429300","259406287","201286610","221745645","242586309","213456338","214056996","262329026","251151522","229817009","250112280","267647450","213410435","258235853","241153140","229374166","275360369","266224679","217924239","241372178","256451729","264367170","230147992","256777250","228629152","255038356","247741132","231673760","253036739","254870376","250626292","225490650","251061523","201394200","237664437","239812727","223659649","248645269" ],
    "Alfragide": ["111111", "111112"]
};
    
// Verifica se NIF j치 respondeu
async function nifJaRegistado(nif) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/participantes?nif=eq.${nif}`, {
        method: "GET",
        headers: {
            'apikey': SUPABASE_API_KEY,
            'Authorization': `Bearer ${SUPABASE_API_KEY}`
        }
    });
    const data = await res.json();
    return data.length > 0;
}

function getSiteDoNif(nif) {
    for (const [site, nifs] of Object.entries(sites)) {
        if (nifs.includes(nif)) return site;
    }
    return null;
}

// Gera c칩digo 칰nico
async function gerarCodigoUnico() {
    const res = await fetch(
        `${SUPABASE_URL}/rest/v1/participantes?select=codigo_negativa&order=codigo_negativa.desc&limit=1`,
        { method: "GET", headers: { 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}` } }
    );
    const data = await res.json();
    return (data.length === 0 || !data[0].codigo_negativa) ? 1 : Number(data[0].codigo_negativa) + 1;
}

// Navega칞칚o
document.getElementById("btnIniciar").addEventListener("click", () => {
    document.getElementById("telaInicial").style.display = "none";
    document.getElementById("conteudoPrincipal").style.display = "flex";
});

function mostrarOpcao() {
    const opcao = document.querySelector('input[name="opcao"]:checked').value;
    document.getElementById("formInscricao").classList.add("hidden");
    document.getElementById("formNegar").classList.add("hidden");
    if (opcao === "inscricao") document.getElementById("formInscricao").classList.remove("hidden");
    else document.getElementById("formNegar").classList.remove("hidden");
}

function mostrarAlerta(mensagem) {
    const alerta = document.getElementById("alertaCentral");
    alerta.innerText = mensagem;
    alerta.classList.remove("hidden");
    setTimeout(() => alerta.classList.add("hidden"), 3000);
}

// Submeter inscri칞칚o
async function gerarInscricao() {
    const nif = document.getElementById("nif").value.trim();
    if (!nif) return mostrarAlerta("Preencha o NIF.");
    if (await nifJaRegistado(nif)) return mostrarAlerta("Este NIF j치 submeteu uma resposta. Para altera칞칫es, contacta-nos.");
    const site = getSiteDoNif(nif);
    if (!site) return mostrarAlerta("Este NIF n칚o est치 autorizado.");
    const codigo = await gerarCodigoUnico();
    const mensagem = `Registo efetuado com sucesso\nNIF: ${nif}\nSite: ${site}\nN칰mero: ${codigo}\n\n\nGuarda este n칰mero m치gico!`;
    document.getElementById("msgInscricao").innerText = mensagem;

    await fetch(`${SUPABASE_URL}/rest/v1/participantes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}`, 'Prefer': 'return=representation' },
        body: JSON.stringify([{ nome: "N칚o informado", coordenacao: "N칚o informada", nif, site, codigo_negativa: codigo, status: "Inscrito" }])
    });

    gerarImagem(mensagem, "Confirmacao_Inscricao.png");
}

// Submeter recusa
async function gerarNegativa() {
    const nif = document.getElementById("nifNegar").value.trim();
    if (!nif) return mostrarAlerta("Preencha o NIF.");
    if (await nifJaRegistado(nif)) return mostrarAlerta("Este NIF j치 submeteu uma resposta. Para altera칞칫es, contacta-nos.");
    const site = getSiteDoNif(nif);
    if (!site) return mostrarAlerta("Este NIF n칚o est치 autorizado.");
    const codigo = await gerarCodigoUnico();
    const mensagem = `Recusa registada com sucesso\nNIF: ${nif}\nN칰mero: ${codigo}\n\n\nGuarda este n칰mero m치gico!`;
    document.getElementById("msgNegar").innerText = mensagem;

    await fetch(`${SUPABASE_URL}/rest/v1/participantes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_API_KEY, 'Authorization': `Bearer ${SUPABASE_API_KEY}`, 'Prefer': 'return=representation' },
        body: JSON.stringify([{ nome: "N칚o informado", coordenacao: "N칚o informada", nif, site, codigo_negativa: codigo, status: "Recusa" }])
    });

    gerarImagem(mensagem, "Recusa_Convite.png");
}

// Gerar imagem
function carregarImagem(src) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
    });
}

async function gerarImagem(texto, nomeArquivo) {
    const canvas = document.createElement("canvas");
    canvas.width = 700;
    canvas.height = 400;
    const ctx = canvas.getContext("2d");

    try {
        const bg = await carregarImagem('TESTE.png');
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#000000";
        ctx.textAlign = "center";

        const linhas = texto.split("\n");
        const lineHeight = 30;
        const totalHeight = (linhas.length - 1) * lineHeight + 36;
        let startY = (canvas.height - totalHeight) / 2 + 10;

        ctx.font = "22px Arial";
        linhas.slice(0, -1).forEach((linha, i) => {
            ctx.fillText(linha, canvas.width / 2, startY + i * lineHeight);
        });

        ctx.font = "36px Arial";
        ctx.fillText(linhas[linhas.length - 1], canvas.width / 2, startY + (linhas.length - 1) * lineHeight);

        const link = document.createElement("a");
        link.download = nomeArquivo;
        link.href = canvas.toDataURL("image/png");
        link.click();
    } catch (err) {
        mostrarAlerta("Erro ao carregar a imagem.");
        console.error(err);
    }
}
</script>
</body>
</html>







